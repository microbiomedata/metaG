backend {
  default = Docker

  providers {

    # Example backend that _only_ runs workflows that specify docker for every command.
    Docker {
      actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
      config {
        run-in-background = true
        runtime-attributes = """
            String docker
            String? docker_user
        """
        submit-docker = """
             rm -f ${docker_cid}
             # run as in the original configuration without --rm flag (will remove later)
             docker run \
               --cidfile ${docker_cid} \
               -i \
               ${"--user " + docker_user} \
               --entrypoint ${job_shell} \
               -v /tmp:/tmp \
               -v ${cwd}:${docker_cwd}:delegated \
               ${docker} ${docker_script}

             # get the return code (working even if the container was detached)
             rc=$(docker wait `cat ${docker_cid}`)

             # remove the container after waiting
             docker rm `cat ${docker_cid}`
        """
      }
    }
  }
}

